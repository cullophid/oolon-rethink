// Generated by CoffeeScript 1.10.0
(function() {
  var curry, parse, parseUrl, ref, rethink, tail;

  rethink = require('rethinkdb');

  ref = require('ramda'), curry = ref.curry, tail = ref.tail;

  parse = require('url').parse;

  parseUrl = (function(_this) {
    return function(url) {
      var hostname, path, port, ref1;
      ref1 = parse(url), hostname = ref1.hostname, port = ref1.port, path = ref1.path;
      return {
        host: hostname,
        port: port,
        db: (tail(path)) || 'test'
      };
    };
  })(this);

  module.exports = (function(_this) {
    return function(url) {
      var _run, connect, options;
      options = parseUrl(url);
      connect = function(options) {
        return rethink.connect(options);
      };
      _run = function(query) {
        return connect(options).then(function(conn) {
          return query.run(conn).then(function(res) {
            conn.close();
            return res;
          });
        });
      };
      return {
        run: _run,
        toArray: function(query) {
          return _run(query).then(function(cur) {
            return cur.toArray();
          });
        },
        each: curry(function(fn, query) {
          return _run(query).then(function(cur) {
            return cur.each(fn);
          });
        }),
        eachAsync: curry(function(fn, query) {
          return _run(query).then(function(cur) {
            return cur.eachAsync(fn);
          });
        })
      };
    };
  })(this);

}).call(this);
