// Generated by CoffeeScript 1.10.0
(function() {
  var curry, parse, parseUrl, ref, rethink, tail;

  rethink = require('rethinkdb');

  ref = require('ramda'), curry = ref.curry, tail = ref.tail;

  parse = require('url').parse;

  parseUrl = (function(_this) {
    return function(url) {
      var hostname, path, port, ref1;
      ref1 = parse(url), hostname = ref1.hostname, port = ref1.port, path = ref1.path;
      return {
        host: hostname,
        port: port,
        db: (tail(path)) || 'test'
      };
    };
  })(this);

  module.exports = (function(_this) {
    return function(url) {
      var _run, connectionPromise;
      connectionPromise = rethink.connect(parseUrl(url));
      _run = function(query) {
        return connectionPromise.then(function(conn) {
          return query.run(conn);
        });
      };
      return {
        run: _run,
        toArray: function(query) {
          return _run(query).then(function(cur) {
            return cur.toArray();
          });
        },
        each: curry(function(fn, query) {
          return _run(query).then(function(cur) {
            return cur.each(fn);
          });
        }),
        eachAsync: curry(function(fn, query) {
          return _run(query).then(function(cur) {
            return cur.eachAsync(fn);
          });
        }),
        each: curry(function(fn, query) {
          return _run(query).then(function(cur) {
            return cur.each(fn);
          });
        })
      };
    };
  })(this);

}).call(this);
